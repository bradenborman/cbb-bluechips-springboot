<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>Log in | Register</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"
          integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Alfa Slab One' rel='stylesheet'>
    <link rel="stylesheet" type="text/css" href="css/Header.css">
    <link rel="stylesheet" type="text/css" href="css/Home.css">
<!--    <script src="js/Generic.js"></script>-->
    <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.0/css/all.css'
          integrity='sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ' crossorigin='anonymous'>
    <link rel="icon"
          href="https://listimg.pinclipart.com/picdir/s/71-713825_clip-art-arrow-bar-chart-diagram-graph-growth.png">
    <meta name="description"
          content="Sign up | Login for CBB BLuechips. The BEST Postseason College Basketball Investing game. "/>
    <meta name="google" content="nositelinkssearchbox"/>
    <meta name="google" content="notranslate"/>
    <meta name="keywords" content="MARCHMADNESS, CBB, COLLEGE, BASKETBALL, INVESTING, FANTASY">
    <meta name="author" content="Braden Borman">
    <meta name="_csrf" th:content="${_csrf.token}"/>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155112023-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-155112023-1');

  if(!location.hostname.includes("local") && location.protocol !== "https:")
  {
       location.protocol = "https:";
  }else if (location.hostname.includes("herokuapp"))
  {
        window.location.replace("https://www.cbb-bluechips.com/");
  }

</script>
</head>
<body>
<header class="header">
    <h1>College Basketball's Bluechips</h1>
</header>
<!--<a href="market/">View Market</a>-->
<div class="container app">
    <div class="row">
        <div class="col-lg-6">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" id="nav-profile-tab" data-toggle="tab" href="#nav-profile"
                       role="tab"
                       aria-controls="nav-profile" aria-selected="true"><i class="fas fa-sign-in-alt"></i> Log In</a>
                    <a class="nav-item nav-link" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab"
                       aria-controls="nav-home" aria-selected="false"><i class="fas fa-user-plus"></i> Sign Up</a>

                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-profile" role="tabpanel"
                     aria-labelledby="nav-profile-tab">
                    <form action="/user/login" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <h2>Returning Users</h2>
                        <div class="row login">
                            <div class="col-md-12">
                                <div th:if="${(param.newUser == null)}" class="form-group">
                                    <input type="text" name="email" id="email" class="form-control" required>
                                    <label th:style="${error} ? 'color:red' : ''" class="form-control-placeholder floatingLbl" id="emailLBL" for="email">Email</label>
                                </div>
                                <div th:if="${(param.newUser != null)}" class="form-group">
                                    <input type="text" name="email" id="email" class="form-control" th:value="${param.newUser}" required>
                                    <label th:style="${error} ? 'color:red' : ''" class="form-control-placeholder floatingLbl" id="emailLBL" for="email">Thank you for signing up!</label>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input type="password" maxlength="12" name="password" id="password"
                                           class="form-control" required>
                                    <label th:style="${error} ? 'color:red' : ''" class="form-control-placeholder floatingLbl" id="passwordLBL" for="password">Password</label>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <button type="submit" class="btn btn-primary btn-block form-control-lg">Submit</button>
                            </div>
                            <div class="col-md-12 forgotPassword">
                                <span onClick="forgotPassword()" id="recoverPassword"><i class='fas fa-directions'></i></span>
                            </div>
                            <br><br>
                        </div>
                    </form>
                    <br/><br/>
                </div>
                <div class="tab-pane fade" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                    <form action="/user/create" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <h2 style="margin-bottom: 30px;">New Users</h2>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input type="text" maxlength="30" name="fname" id="fname" class="form-control" required>
                                    <label class="form-control-placeholder floatingLbl" id="fnameLBL" for="fname">First Name</label>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input type="text" maxlength="30" name="lname" id="lname" class="form-control"
                                           required>
                                    <label class="form-control-placeholder floatingLbl" id="lnameLBL" for="lname">Last
                                        Name</label>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input type="text" name="email_new" id="email_new" class="form-control" required>
                                    <label class="form-control-placeholder floatingLbl" id="email_newLBL"
                                           for="email_new">Email</label>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <input type="password" maxlength="12" name="password_new" id="password_new"
                                           class="form-control" required>
                                    <label class="form-control-placeholder floatingLbl" id="password_newLBL"
                                           for="password_new">Password</label>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <button type="submit" class="btn btn-primary btn-block form-control-lg">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- END LEFT -->

        <div class="my-hr"></div>
        <div class="col-lg-6">
            <div id="newFeatures">
                <h4 style="margin-bottom: 30px;">2021 New Features</h4>
                <div class="feature"><i style="color: green; font-size: 1.3em" class='fas fa-sms'></i> <b>Text
                    Alerts</b>
                    <p>Subscribe to "text alerts" for instant price changing text notifications once games have been
                        played!</p></div>
                <div class="feature">
                    <i style="font-size: 1.3em" class='fab fa-rocketchat'></i> <b>Comment Threads</b>
                    <p>User can post questions or comments where others may reply.</p>
                </div>
                <div class="feature">
                    <i style="color: #3ad1df; font-size: 1.3em" class='fas fa-chart-bar'></i> <b>Posted Point Spread</b>
                    <p>No longer will a trip to ESPN be necessary for gathering information on the on the point
                        spread</p>
                </div>
                <div class="feature">
                    <i style="color: orange; font-size: 1.3em" class='fas fa-user-friends'></i> <b>Groups</b>
                    <p>Keep tabs of all your buddies!</p>
                </div>
                <div class="feature">
                   <p><a style="font-weight: bold;" href="/rules">How to play CBB Bluechips</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- Modal -->
<div class="modale" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-header">
            <h2>Password Recovery</h2>
        </div>
        <div class="modal-body">
            <p id="emailFeedback">Attempting to send email...</p>
        </div>
    </div>
</div>
<!-- /Modal -->
<footer>
    <center>For issues, please contact: <br/><b>Braden Borman</b> | (573) 826-1903</center>
</footer>

<script>

setTimeout(function(){
 shouldShowPasswordRecovery($("#email").val())
 }, 350);

$(document).ready(function(){

	$("#email").keyup(function() {
		  shouldShowPasswordRecovery($(this).val())
	});

	$('#fnameLBL').click(function(){
	  	$('#fname').focus()
	});

	$('#lnameLBL').click(function(){
	  	$('#lname').focus()
	});

	$('#email_newLBL').click(function(){
	  	$('#email_new').focus()
	});


	$('#password_newLBL').click(function(){
	  	$('#password_new').focus()
	});


	$('#emailLBL').click(function(){
	  	$('#email').focus()
	});


	$('#passwordLBL').click(function(){
	  	$('#password').focus()
	});
});



function forgotPassword() {
	var email = $("#email").val();

    var token = $('meta[name="_csrf"]').attr('content')
    $.ajaxSetup({
       headers:{
          "X-CSRF-TOKEN" : token
       }
    });

	if (validateEmail(email)) {
          $('.modale').addClass('opened');
          $.post("/email/recover",
          {
            emailToRecover: email
          },
          function(returnString, status){

            $("#emailFeedback").html(returnString)

            setTimeout(function(){
                $('.modale').removeClass('opened');
                $("#emailFeedback").text("Attempting to send email...")
            }, 5000);

          });

	}

}

function validateEmail(email) {
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(email).toLowerCase());
}

function shouldShowPasswordRecovery(email) {

	if (validateEmail(email)) {
 		$("#recoverPassword").html("Forgot Password? Click me")
	}else {
		$("#recoverPassword").html("Enter valid Email for password recovery")
	}
}

</script>

</body>
</html>
